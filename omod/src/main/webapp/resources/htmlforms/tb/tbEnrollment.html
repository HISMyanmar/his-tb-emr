<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
  -->
<htmlform>

<style type="text/css">
table.tb {
	background-color: #c7d8a7;
	border: 1px solid black;
}

table.tb1 {
	border: 1px solid black;
	vertical-align: baseline;
	text-align: left;
	background-color: #e8efdc;
}

table.tb1 tr th, table.tb1 tr td {
	border: 0;
	padding: 10px;
}
</style>

<script type="text/javascript">
		jq(document).ready(function(){
			
			// show fields with data 
			fieldIndex = 10; 
			j=1;
			while(document.getElementById("w"+fieldIndex).value!="" &amp;&amp; j &lt; 6){
				jQuery('#'+j+'-toggleContainer').show();   
				fieldIndex=fieldIndex+2;
				j++;
			}
			
	
			$j('#1-removeEntry').remove();
			$j('#5-addEntry').remove();
			$j('#1-toggleContainer').show();
			
			
			$j('button.addEntry').on("click", function(){
				var correctedAddButtonId = parseFloat(this.id) + 1;      
				var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
				$j(contentAddId).toggle(true);      
				$j('#' + this.id).toggle(false); 
				$j('#' + parseFloat(this.id) + '-removeEntry').toggle(false);
				return false;});    
			 
			$j('button.removeEntry').on("click", function(){ 
				var correctedRemoveButtonId = parseFloat(this.id) - 1;
				var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
				$j(contentAddId).toggle(false);
				$j( ':input:not(:button)', contentAddId).val([]);
				$j('#' + correctedRemoveButtonId + '-addEntry').toggle(true);
				$j('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);
				return false;
				});
			
		
			// show fields with data 
			if( getValue('regGroup.value')!=null){
				fieldIndex = 81;
			}
			else{
				fieldIndex = 31;
			}
			j=1;
			while(document.getElementById("w"+fieldIndex).value!="" &amp;&amp; j &lt; 3){
				//alert(document.getElementById("w"+38).value);
				jQuery('#'+j+'-toggleContainer1').show();   
				fieldIndex=fieldIndex+6;
				if(document.getElementById("w"+fieldIndex).value != '')
					{
					alert(fieldIndex);
				$j('#'+j+'-removeEntry1').toggle(false);
				$j('#'+j+'-addEntry1').toggle(false);
					}
				j++;
				
			}
	
			$j('#1-removeEntry1').remove();
			$j('#2-addEntry1').remove();
			$j('#1-toggleContainer1').show();
			
			$j('button.addEntry1').on("click", function(){
				var correctedAddButtonId = parseFloat(this.id) + 1;      
				var contentAddId = "#" + correctedAddButtonId + "-toggleContainer1";
				$j(contentAddId).toggle(true);      
				$j('#' + this.id).toggle(false); 
				$j('#' + parseFloat(this.id) + '-removeEntry1').toggle(false);
				
				return false;});    
			 
			$j('button.removeEntry1').on("click", function(){ 
				
				var correctedRemoveButtonId = parseFloat(this.id) - 1;
				var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer1";
				$j(contentAddId).toggle(false);
				$j( ':input:not(:button)', contentAddId).val([]);
				$j('#' + correctedRemoveButtonId + '-addEntry1').toggle(true);
				$j('#' + correctedRemoveButtonId + '-removeEntry1').toggle(true);
				return false;
				});

			// show fields with data 
			fieldIndex = 77; 
			j=1;
			while(document.getElementById("w"+fieldIndex).value!="" &amp;&amp; j &lt; 6){
				//alert(document.getElementById("w"+38).value);
				jQuery('#'+j+'-toggleContainer2').show();   
				fieldIndex=fieldIndex+2;
				if(document.getElementById("w"+fieldIndex).value != '')
					{
				$j('#'+j+'-removeEntry2').toggle(false);
				$j('#'+j+'-addEntry2').toggle(false);
					}
				j++;
				
			}

			$j('#1-removeEntry2').remove();
			$j('#5-addEntry2').remove();
			$j('#1-toggleContainer2').show();
			
			$j('button.addEntry2').on("click", function(){
				var correctedAddButtonId = parseFloat(this.id) + 1;      
				var contentAddId = "#" + correctedAddButtonId + "-toggleContainer2";
				$j(contentAddId).toggle(true);      
				$j('#' + this.id).toggle(false); 
				$j('#' + parseFloat(this.id) + '-removeEntry2').toggle(false);
				
				return false;});    
			 
			$j('button.removeEntry2').on("click", function(){ 
				
				var correctedRemoveButtonId = parseFloat(this.id) - 1;
				var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer2";
				$j(contentAddId).toggle(false);
				$j( ':input:not(:button)', contentAddId).val([]);
				$j('#' + correctedRemoveButtonId + '-addEntry2').toggle(true);
				$j('#' + correctedRemoveButtonId + '-removeEntry2').toggle(true);
				return false;
				});
			
			
			var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
			var d = new Date(getValue('curDate.value'));
			var today = new Date();
			if(d!="Invalid Date"){
			
				d.setDate(d.getDate() + 280);
				document.getElementById("w77-display").value =  d.getDate() + "-" + months[d.getMonth()-1] + "-" + d.getFullYear();
				document.getElementById("w77").value = d.getFullYear()  + "-" +  d.getMonth() 	+ "-" + d.getDate();
			}
			else{
				document.getElementById("w77-display").value =  "";
				document.getElementById("w77").value = "";
			}
			
			var da = new Date(getValue('curDate.value'));
			da.setDate(da.getDate() + 250);
			var edd = new Date(da);
			var today = new Date();
			if(edd-today &lt; 0){
			//	$('.ke-form-content').find('input:text').val('');
				$(':input').not(':button, :submit, :reset, :hidden, :checkbox, :radio').val('');
				$(':checkbox, :radio').prop('checked', false);
				jq('#fPlanningOption :input').prop('disabled', true);
				jq('#ifYesPregnancy :input').prop('disabled', true);
				jq('#infantTable :input').prop('disabled', true);
				
			}
		
			jq("#curDate :input").change(function() {
				var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
				var d = new Date(getValue('curDate.value'));
				var today = new Date();
				if(d!=""){
					jQuery('#mbdDate').html(Math.round(parseInt((today - d) / (1000 * 60 * 60 * 24)) /7));
					d.setDate(d.getDate() + 280);
					document.getElementById("w77-display").value =  d.getDate() + "-" + months[d.getMonth()-1] + "-" + d.getFullYear();
					document.getElementById("w77").value = d.getFullYear()  + "-" +  d.getMonth() 	+ "-" + d.getDate();
					
				}
				else{
					document.getElementById("w77-display").value =  "";
					document.getElementById("w77").value = "";
				}
			});
/*			
			var pbirthdate = new Date("<lookup expression="patient.birthdate" />").getTime();

			//check if the date of tb treatment already exists
			var treatmentDate = "<lookup expression="fn.latestObs(1113).valueDate" />"

			//set the value of the treatment date if available
			setValue('dstartoftreatment.value', treatmentDate);
			
			var pulmodiv = document.getElementById('iddivPulmonary');
			var expulmodiv = document.getElementById('expul');
			//getting the values of the disease classification option buttons
			var optValues = getValue('dclassification.value');
				if (optValues == 42){
					jq('#expul :input').prop('disabled', true);
    				jq('#iddivPulmonary :input').prop('disabled', false);
				}
				else if (optValues == 5042 ){
					jq('#iddivPulmonary :input').prop('disabled', true);
    				jq('#expul :input').prop('disabled', false);
				}
				else {
					jq('#iddivPulmonary :input').prop('disabled', true);
    				jq('#expul :input').prop('disabled', true);
				}
				
    			$('#dclassification input:radio').click(function() {
    				if (jq(this).val() == 42) {
    					jq('#expul :input').prop('disabled', true);
    					jq('#iddivPulmonary :input').prop('disabled', false);
    				}
    				if (jq(this).val() == 5042) {
    					jq('#iddivPulmonary :input').prop('disabled', true);
    					jq('#expul :input').prop('disabled', false);
    				}
    			});
   			//activating the transfer in details only when the patient classification is transfer in
   			//patientClassification
   			var optpatientclassification = getValue('patientClassification.value');

   				if (optpatientclassification == 159872 ) {
   					jq('#transferInDetails :input').prop('disabled', false);
   				}

   				else {
   					jq('#transferInDetails :input').prop('disabled', true)
   				}
   				
   				jq('#patientClassification input:radio').click(function() {

   					if (jq(this).val() == 159872){
   						jq('#transferInDetails :input').prop('disabled', false);
   					}

   					else {
   						jq('#transferInDetails :input').prop('disabled', true);
   					}
   				});
 			//hide the div tags that hold errors on the start of the form
 			jq('#startOfTreatmentDateError').hide();
 			jq('#referalDateError').hide();
 			jq('#transferInDatesError').hide();
 			
 			//control the transfer in option 
 			jq('#referredByOptions1 input:radio').click(function() {
 				jq( '#referredByOptions2 input:radio' ).prop( "checked", false );
 			});

 			jq('#referredByOptions2 input:radio').click(function() {
 				jq('#referredByOptions1 input:radio' ).prop( "checked", false );
 			});
    			

			//create some variable that will control the dates on the form not to be earlier than DOB
			var pbirthdate = new Date("<lookup expression="patient.birthdate" />").getTime();
			var encounterdate;
			var dstartoftreatment;
			var dreferredby;
			var transferindate;
			var dfirstenrolled;
            var treatmentSupporterNumber;
            var regex = /^\+?\d{7,13}$/
	*/	
			beforeSubmit.push (function() {
	/*			encounterdate = new Date(getValue('encounter-date.value')).getTime();
       			datestartoftreatment = new Date(getValue('dstartoftreatment.value')).getTime();
       			dreferredby = new Date(getValue('datereferredby.value')).getTime();
       			transferindate  = new Date(getValue('transferindate.value')).getTime();
       			dfirstenrolled = new Date(getValue('datefirstenrolled.value')).getTime();
                treatmentSupporterNumber = getValue('treatmentSupportedNumber.value');

                if (treatmentSupporterNumber != '' &amp;&amp; !regex.test(treatmentSupporterNumber)){
                    jq('#treatmentsupportError').html('Please provide valid phone Number');
                    return false;
                }

       			if (encounterdate &lt; pbirthdate) {
               		getField('encounter-date.error').html('Encounter datetime should be after the birth date').show();
                   	return false
         		}
         		
          		if (datestartoftreatment &lt; pbirthdate) {
          			jq('#startOfTreatmentDateError').show();
               		jq('#startOfTreatmentDateError').html('Date start of treatment should be after the birth date');
                   	return false
         		}
         	         
        		if (dreferredby &lt; pbirthdate) {
        			jq('#referalDateError').show();
               		jq('#referalDateError').html('Date referred by should be after the birth date');
                   	return false
         		}
         		
         		if (transferindate &lt; pbirthdate) {
         			jq('#transferInDatesError').show();
               		jq('#transferInDatesError').html('Transfer in date should be after the birth date');
                   	return false
         		}
          		if (dfirstenrolled &lt; pbirthdate){
          			jq('#transferInDatesError').show();
               		jq('#transferInDatesError').html('Date first enrolled should be after the birth date');
                   	return false
         		}
*/
    			return true;
			});
			//try add load treatment supporter's information if available from other places for this patient
	/*		var treatmentSuppoterNames = "<lookup expression="fn.latestObs(160638).valueText" />";
			var treatmentSuppoterRelation = "<lookup expression="fn.latestObs(160640).valueCoded" />";;
			var treatmentSuppoterAddress = "<lookup expression="fn.latestObs(160641).valueText" />";;
			var treatmentSuppoterPhoneNumber = "<lookup expression="fn.latestObs(160642).valueText" />";
			//populate the fields
			setValue('tSupporterNames.value', treatmentSuppoterNames);
			setValue('tSupporterRelation.value', treatmentSuppoterRelation);
			setValue('tSupporterAddress.value', treatmentSuppoterAddress);
			setValue('treatmentSupportedNumber.value', treatmentSuppoterPhoneNumber);
*/
		});
	</script>
	<script type="text/javascript">
		function mbdCalculation() {
			var display = '';
			
			var d = new Date(getValue('curDate.value'));
			var today = new Date();
			if(d!="Invalid Date"){
				display=Math.round(parseInt((today - d) / (1000 * 60 * 60 * 24)) /7) + " week";
			}
			jQuery('#mbddate').html(display );
		}
		jQuery(function() {
			getField('curDate.value').change(mbdCalculation);
			
			
			var da = new Date(getValue('curDate.value'));
			da.setDate(da.getDate() + 250);
			var edd = new Date(da);
			var today = new Date();
			if(edd-today &lt; 0){
				jQuery('#mbddate').html('');
			}
			else{
				mbdCalculation();	
			}
		});
		
	</script>
	<div style="display:none">
		<encounterDate id="encounter-date" showTime="true" />
		<encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" />
	</div>

<div class="ke-form-content">
	<table width="80%" align="center" border="0" class="tb" cellspacing="10">
		<tr>
			<td colspan="2">
				<div class="ke-form-instructions">
					<b>*</b> indicates a required field
				</div>
			</td>
		</tr>
		<tr>
			<td align="center" colspan="2"> 
				<h5>
					<b>MDR-TB Information</b>
				</h5>
			</td>
		</tr>
		<tr>
			<td width="40%" valign="top">
				<table class="tb1" border="0" width="100%">
					<tr>
						<td>Disease Classification</td>
						<td><obs conceptId="160040AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
								style="radio" id="dclassification" /></td>
					</tr>
					<tr>
						<td>If Extra -pulmonary, specific site</td>
						<td>
							<table width="80%">
								<obsgroup
									groupingConceptId="161357AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
								<repeat> <template>
								<tr id="{n}-toggleContainer" style="display: none;">
									<td><obs conceptId="5d710188-5b99-4d39-8c93-a562c02c452a"
											style="dropdown" labelText=" " /></td>
									<td><button id="{n}-addEntry" class="addEntry">Add</button>
										<button id="{n}-removeEntry" class="removeEntry">Remove</button>
									</td>
								</tr>
								</template> <render n="1" concept=" " /> <render n="2" concept=" " /> <render
									n="3" concept=" " /> <render n="4" concept=" " /> <render
									n="5" concept=" " /> </repeat> </obsgroup>
							</table>
						</td>
					</tr>
					<tr>
						<td></td>
						<td>Other <obs
								conceptId="160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
					</tr>
					<tr>
						<td>MDR-TB registration number</td>
						<td ><patient field="identifier"
								identifierTypeId="d8ee3b8c-a8fc-4d6b-af6a-9423be5f8906"
								required="true" /></td>
					</tr>
					<tr>
						<td>Date of the MDR-TB registration number</td>
						<td><obs conceptId="1819AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
					</tr>
					<tr>
						<td>Hospital Number</td>
						<td><obs conceptId="1475AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
					</tr>
					<tr>
						<td>Date of getting the hospital number</td>
						<td><obs conceptId="1818AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
					</tr>
				</table>
			</td>
			<td width="50%" valign="top">
				<fieldset>
					<table  class="tb1" border="0" width="100%"> 
						<tr>
						<td colspan="2">
							<table>
								<tr>
									<th colspan="3"><center>DOT provider/supervisor
											details</center></th>
								</tr>
								<tr>
									<th><center>DOT provider name</center></th>
									<th><center>DOT provider Contact No.</center></th>
									<th><center>DOT Supervisor</center></th>
								</tr>
								<tr>
									<repeat> <template> <obsgroup
										groupingConceptId="1418AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
									<tr id="{n}-toggleContainer1" style="display: none;">
										<td valign="top">{n}.<obs
												conceptId="160750AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
										</td>
										<td valign="top"><obs
												conceptId="1561AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
												style="dropdown" /></td>
										<td valign="top"><obs
												conceptId="1473AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
												allowFutureDates="true" /></td>
										<td><button id="{n}-addEntry1" class="addEntry1">Add</button>
											<button id="{n}-removeEntry1" class="removeEntry1">Remove</button>
										</td>
									</tr>
									</obsgroup> </template> <render n="1" concept=" " /> <render n="2" concept=" " /> </repeat>
								</tr>
							</table>

						</td>
					</tr>
					<tr>
						<td>Patient type</td>
						<td><obs conceptId="159871AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
					</tr>
					<tr>
						<td>Registration group</td>
						<td><obs conceptId="159976AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" required="true" id="regGroup"/></td>
					</tr>
					<tr>
						<td>Contact of MDR-TB cases</td>
						<td><obs conceptId="1526AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
								style="radio" /></td>
					</tr>
					<tr>
						<td>Treatment centre</td>
						<td><obs conceptId="be719294-8fe8-41eb-9218-ce2c9e7ef2ba" /></td>
					</tr>
					</table>
				</fieldset>
			</td>
		</tr>
		<tr id="topMost">
			<td width="50%" valign="top">
				
			
				<fieldset>
					<h5>
						<b>HIV Information</b>
					</h5>
					<table class="tb1" border="0" width="100%">
						<tr>
							<td>HIV testing done</td>
							<td><obs conceptId="159938AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
									style="radio" required="true"/></td>
						</tr>
						<tr>
							<td>Date of test</td>
							<td><obs conceptId="160751AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
						</tr>
						<tr>
							<td>Result</td>
							<td><obs conceptId="305AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
						</tr>
						<tr>
							<td>If reactive, treatment taking at NAP center</td>
							<td><obs conceptId="dc3f16ef-1beb-4c57-8182-df37c70f40ed"
									style="radio" /></td>
						</tr>
						<tr>
							<td>If yes, Pre ART/ART registration number</td>
							<td><obs conceptId="1762AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
						</tr>
						<tr>
							<td>If No, Name of HIV treatment center</td>
							<td><obs conceptId="be719294-8fe8-41eb-9218-ce2c9e7ef2ba" /></td>
						</tr>
						<tr>
							<td>Started on ART</td>
							<td><obs conceptId="162127AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
									style="radio" /></td>
						</tr>
						<tr>
							<td>Date</td>
							<td><obs conceptId="162550AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
						</tr>
						<tr>
							<td>Current HIV regimen</td>
							<td><obs conceptId="1400AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
									style="autocomplete" answerClasses="drug" /></td>
						</tr>
						<tr>
							<td>Started on CPT</td>
							<td><obs conceptId="112234AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
									style="radio" /></td>
						</tr>
						<tr>
							<td>Date</td>
							<td><obs conceptId="431adda7-582e-4822-83a6-25344f21fc7c" /></td>
						</tr>
					</table>
				</fieldset>
				</td>
			<td valign="top">
			<fieldset>
					<h5>
						<b>Other medical information</b>
					</h5>
					<table border="0" class="tb1" width="100%">
						<tr>
							<td>Pregnancy</td>
							<td><obs conceptId="5272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
									style="radio" /></td>
						</tr>
						<tr>
							<td>If yes, LMP</td>
							<td><obs conceptId="1427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="curDate"/></td>
						</tr>
						<tr>
							<td>EDD</td>
							<td><obs conceptId="5596AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true" id="nextDate"/></td>
						</tr>
						<tr>
							<td>MBD</td>
							<td> <span id="mbddate" class="value"></span></td>
						</tr>
						<tr>
							<td>Co-morbidities</td>
							<td>
								<table>
									<repeat> <template>
									<tr id="{n}-toggleContainer2" style="display: none;">
										<td>{n}.<obs
												conceptId="6f3ac1ca-0500-4286-9c62-7190c4e792d9"
												style="autocomplete" labelText=" " /></td>
										<td><button id="{n}-addEntry2" class="addEntry2">Add</button>
											<button id="{n}-removeEntry2" class="removeEntry2">Remove</button>
										</td>
									</tr>
									</template> <render n="1" concept=" " /> <render n="2" concept=" " /> <render
										n="3" concept=" " /> <render n="4" concept=" " /> <render
										n="5" concept=" " /> </repeat>
								</table>
							</td>
						</tr>

						<tr>
							<td>Drug Allergy</td>
							<td><obs conceptId="141760AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
									style="radio" required="true"/></td>
						</tr>
						<tr>
							<td>If yes, name of drug</td>
							<td><obs conceptId="06ba79f6-7344-456a-8265-35f87d43394f" /></td>
						</tr>
					</table>
				</fieldset>
			</td>
		</tr>
	</table>

	<enrollInProgram programId="9f144a34-3a4a-44a9-8486-6b7af6cc64f6" />
</div>

<div class="ke-form-footer">
	<submit />
</div>

</htmlform>